#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  Magic Pod UI test
summary: |
  Magic Pod UI test step
description: |
  Magic Pod UI test step
website: https://github.com/magic-Pod/bitrise-step-magicpod-uitest
source_code_url: https://github.com/magic-Pod/bitrise-step-magicpod-uitest
support_url: https://github.com/magic-Pod/bitrise-step-magicpod-uitest/issues

# If this step should be available only for certain project types
# just uncomment this `project_type_tags` section and include all the
# project types supported by the step. If the step can be used for all
# project types then you can just remove this section.
# If no `project_type_tags` specified (or specified as an empty array)
# that means the step can be used for any project type.
# You can find more information about project type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
#
project_type_tags:
  - ios
  - android

# Type tags are used for categorizing steps, for easier step discovery in Step Libraries.
# You can find more information about type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
type_tags:
  - test

is_requires_admin_user: false
is_always_run: false
is_skippable: false
run_if: ""

toolkit:
  go:
    package_name: github.com/magic-Pod/bitrise-step-magicpod-uitest


inputs:
  - magic_pod_api_token:
    opts:
      title: "Magic Pod API token"
      description: |-
        Access token to use Magic Pod Web API.
        
        * Key: Arbitrary new Secret Env name like `MAGIC_POD_API_TOKEN`
        * Value: API token copied from https://magic-pod.com/accounts/api-token/. 
      is_required: true
      is_expand: true
      is_sensitive: true
  - organization_name:
    opts:
      title: "Organization name"
      description : |-
        Organization name in Magic Pod.
        Please be sure to use **organization name**, not **display name**.
      is_required: true
      is_expand: true
  - project_name:
    opts:
      title: "Project name"
      description : |-
        Project name in Magic Pod.
        Please be sure to use **project name**, not **display name**.
      is_required: true
      is_expand: true
  - test_condition_number: "1"
    opts:
      title: "Test condition number"
      description: |-
        Test condition number specified on Magic Pod project batch run page.
      is_required: true
  - app_path: "$BITRISE_APP_DIR_PATH"
    opts:
      title: "App path"
      description: |-
        Path to app (apk/app/ipa) file you want to test.
        Note that you need to select _App file (cloud upload)_ for _App Type_ on Magic Pod project batch run page.
        * *Warning: The file of the specified path is uploaded to Magic Pod cloud and can be seen by project members.*
        * For iOS simulator testing, specify the directory _xx.app_ so that included files are automatically ziped into one file before uploading. 
      is_expand: true
  - wait_for_result: "true"
    opts:
      title: "Wait for result"
      description: |-
        If set to true, this step waits until Magic Pod testing is completed and succeeds only when the test is successful.
        Otherwise this step immediately exits with success.
  - delete_app_after_test: "Not delete"
    opts:
      title: "Delete app after test"
      description: |-
        Define how to tread the uploaded app file after the test.
        This option is valid only when you specify _App path_.
      value_options: ["Not delete", "Always delete", "Delete only when tests succeeded"]
  - test_settings:
    opts:
      title: "Test settings"
      description: |-
        You can specify settings you want to override on already defined ones with JSON format.
        For detail format, you can see API document (https://magic-pod.com/api/v1.0/doc/) or try "Copy as curl" command on project batch run page.
      category: "detail"
      is_required: false
  - base_url: "https://magic-pod.com/api/v1.0"
    opts:
      title: "Magic Pod web API URL"
      description: |-
        Cannot be changed
      is_dont_change_value: true
      category: "debug"


outputs:
  - MAGIC_POD_TEST_STATUS:
    opts:
      title: "MAGIC_POD_TEST_STATUS"
      summary: |-
        Status of batch test run. The value is either of 'succeeded', 'failed', 'aborted', 'running'.
  - MAGIC_POD_TEST_PASSED_COUNT:
    opts:
      title: "MAGIC_POD_TEST_PASSED_COUNT"
      summary: |-
        The number of succeeded test cases in the batch run.
  - MAGIC_POD_TEST_FAILED_COUNT:
    opts:
      title: "MAGIC_POD_TEST_FAILED_COUNT"
      summary: |-
        The number of failed test cases in the batch run.
  - MAGIC_POD_TEST_UNRESOLVED_COUNT:
    opts:
      title: "MAGIC_POD_TEST_UNRESOLVED_COUNT"
      summary: |-
        The number of unresolved test cases in the batch run.
  - MAGIC_POD_TEST_TOTAL_COUNT:
    opts:
      title: "MAGIC_POD_TEST_TOTAL_COUNT"
      summary: |-
        The number of total test cases in the batch run.
  - MAGIC_POD_TEST_URL:
    opts:
      title: "MAGIC_POD_TEST_URL"
      summary: |-
        URL of Magic Pod batch run page
